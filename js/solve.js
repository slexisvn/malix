"undefined"!=typeof module&&(nerdamer=require("./nerdamer.core.js"),require("./Calculus.js"),require("./Algebra.js")),function(){var e=nerdamer.getCore(),n=e.PARSER,t=e.Algebra,r=e.Calculus,i=r.integration.decompose_arg,o=e.Utils.remove,a=e.Utils.format,s=e.Utils.build,l=e.Symbol,u=e.Utils.isSymbol,c=e.Utils.variables,p=e.groups.S,f=e.groups.PL,v=e.groups.CB,g=e.groups.CP,m=e.groups.FN,h=e.Utils.isArray;function S(n,t){if(t.isConstant()&&n.isConstant()&&!n.equals(t)||n.equals(e.Settings.IMAGINARY)||t.equals(e.Settings.IMAGINARY))throw new Error(n.toString()+" does not equal "+t.toString());this.LHS=n,this.RHS=t}e.Solve={version:"1.2.5",solve:function(n,t){var r=q(n,String(t));return new e.Vector(r)}},e.Settings.SOLVE_RADIUS=1e3,e.Settings.ROOTS_PER_SIDE=5,e.Settings.make_pi_conversions=!0,e.Symbol.prototype.hasTrig=function(){return this.containsFunction(["cos","sin","tan","cot","csc","sec"])},e.Symbol.prototype.hasNegativeTerms=function(){if(this.isComposite())for(var e in this.symbols){var n=this.symbols[e];if(n.group===f&&n.hasNegativeTerms()||this.symbols[e].power.lessThan(0))return!0}return!1};var b=function(e,t){if(t.group===g&&t.group!==g){var r=e;e=t,t=r}if(e.group===v){r=new l(e.multiplier);var i=t.clone();e.each(function(e){e.power.lessThan(0)?i=n.divide(i,e):r=n.multiply(r,e)}),e=r,t=i}else if(e.group===g)for(var o in e.symbols){var a=e.symbols[o];if(a.group===v)for(var s in a.symbols){var u=a.symbols[s];if(u.power.lessThan(0))return b(n.expand(n.multiply(u.clone().toLinear(),e)),n.expand(n.multiply(u.clone().toLinear(),t)))}}return n.expand(n.subtract(e,t))};S.prototype={toString:function(){return this.LHS.toString()+"="+this.RHS.toString()},text:function(e){return this.LHS.text(e)+"="+this.RHS.text(e)},toLHS:function(){return b(this.LHS.clone(),this.RHS.clone())},clone:function(){return new S(this.LHS.clone(),this.RHS.clone())},sub:function(e,n){var t=this.clone();return t.LHS=t.LHS.sub(e.clone(),n.clone()),t.RHS=t.RHS.sub(e.clone(),n.clone()),t},isZero:function(){return e.Utils.evaluate(this.toLHS()).equals(0)},latex:function(e){return[this.LHS.latex(e),this.RHS.latex(e)].join("=")}},n.equals=function(e,n){return new S(e,n)};var d=function(e){if(e instanceof S)return e.toLHS();var t=e.split("=");void 0===t[1]&&(t[1]="0");var r=n.parse(t[0]),i=n.parse(t[1]);return b(r,i)},y=e.Utils.checkAll=function(e,n){for(var t=0;t<e.length;t++)if(n(e[t]))return!1;return!0},w=function(e,t,r,i){var o="-"===i?"subtract":"add",a=n.subtract(n.pow(t.clone(),l(2)),n.multiply(n.multiply(r.clone(),e.clone()),l(4))),s=n.pow(a,l(.5));return n.divide(n[o](t.clone().negate(),s),n.multiply(new l(2),r.clone()))},x=function(t,r,i,o){var s=o.text(),l=i.text(),u=r.text(),p=t.text(),f=n.parse(a("({1})^2-3*({0})*({2})",s,l,u)),v=n.parse(a("((2*({1})^3-9*({0})*({1})*({2})+27*({0})^2*({3}))^2-4*(({1})^2-3*({0})*({2}))^3)^(1/2)",s,l,u,p)),g=n.parse(a("((1/2)*(({4})+2*({1})^3-9*({0})*({1})*({2})+27*({0})^2*({3})))^(1/3)",s,l,u,p,v)),m={};c(g).map(function(e){m[e]=1});var h=e.Utils.block("PARSE2NUMBER",function(){return n.parse(g,m)});return 0===Number(f)&&0===Number(h)&&(g=n.parse(a("((1/2)*(-({4})+2*({1})^3-9*({0})*({1})*({2})+27*({0})^2*({3})))^(1/3)",s,l,u,p,v))),["-(b/(3*a))-C/(3*a)-(((b^2-3*a*c))/(3*a*C))","-(b/(3*a))+(C*(1+i*sqrt(3)))/(6*a)+((1-i*sqrt(3))*(b^2-3*a*c))/(6*a*C)".replace(/i/g,e.Settings.IMAGINARY),"-(b/(3*a))+(C*(1-i*sqrt(3)))/(6*a)+((1+i*sqrt(3))*(b^2-3*a*c))/(6*a*C)".replace(/i/g,e.Settings.IMAGINARY)].map(function(e,a){return n.parse(e,{a:o.clone(),b:i.clone(),c:r.clone(),d:t.clone(),C:g.clone()})})},R=function(n,t){var r=[],i=e.Algebra.Factor.factor(n);return i.group===v&&i.each(function(e){e=l.unwrapPARENS(e),r=r.concat(q(e,t))}),r},U=function(t,r){return e.Utils.block("IGNORE_E",function(){var i,o,s,u,c,f,v,g;if(g=[],(i=e.Utils.decompose_fn(t,r,!0)).x.group===p){var m,h;o=n.parse(i.x.power),s=Number(o),u=n.pow(n.divide(i.b.negate(),i.a),o.invert()),f=(c=l.toPolarFormArray(u))[0],c[1],v=f.toString(),o.toString();for(var S=0;S<s;S++)h=a("({0})*e^(2*{1}*pi*{2}*{3})",v,S,o,e.Settings.IMAGINARY),m=n.parse(h),g.push(m)}return g},!0)},q=function(b,H,L){if(b instanceof S){if(b.isZero())return[new l(0)];if(b.LHS.equals(H))return[b.RHS];if(b.RHS.equals(H))return[b.LHS]}if(b instanceof e.Vector&&(b=b.elements),H=H||"x",h(b))return function(r,a){for(var s=0;s<r.length;s++)r[s]=d(r[s]);var u,p=r.length,f=new e.Matrix,v=new e.Matrix,g=!1;if(void 0===a){for(t.allLinear(r)||e.err("System must contain all linear equations!"),u=c(r[0]),s=1;s<p;s++)u=u.concat(c(r[s]));for(u=e.Utils.arrayUnique(u).sort(),s=0;s<u.length;s++)nerdamer.setVar(u[s],"delete");for(s=0;s<p;s++){for(var m=r[s],h=0;h<p;h++){var S=m.symbols[u[h]];f.set(s,h,S?S.multiplier:0)}var b=m.symbols["#"];v.set(s,0,new l(b?-b.multiplier:0))}}else for(u=a,g=!0,s=0;s<p;s++){for(v.set(s,0,new l(0)),m=n.expand(r[s]).collectSymbols(),h=0;h<a.length;h++){f.set(s,h,new l(0));for(var y=a[h],w=0;w<m.length;w++){for(var x=m[w],R=!1,U=0;U<a.length;U++)x.contains(a[U])&&(R&&e.err("Multiple variables found for term "+x),R=!0);if(x.contains(y)){var q=i(o(m,w),y);f.set(s,h,n.add(f.get(s,h),q[0]))}}}for(w=0;w<m.length;w++)v.set(s,0,n.add(v.get(s,0),m[w]))}var H=[];return(f=f.invert()).multiply(v).each(function(e,t){H.push([u[t],(g?n.expand(e):e).valueOf()])}),H}.apply(void 0,arguments);if(L=L||[],b.group===p&&b.contains(H))return L.push(new l(0)),L;if(b.group===v){var E=String(H);return b.each(function(e){e.contains(E)&&q(e,H,L)}),L}var A={},N=function(t,r){var i=u(t);if(!(void 0===t||"number"==typeof t&&isNaN(t)))if(h(t))L=L.concat(t);else if("null"!==t.valueOf()){if(i||(t=n.parse(t)),e.Settings.make_pi_conversions&&r){var o=n.divide(t.clone(),new l(Math.PI)),a=o.multiplier,s=Math.abs(a.num),c=Math.abs(a.den);s<10&&c<10&&(t=n.multiply(o,new l("pi")))}var p=t.toString();A[p]||L.push(t),A[p]=!0}},M=function(e,n,t){var r,i=0,o=e;do{var a=n(o);if(0===o&&0===a){r=0;break}if(++i>200)return;r=o-a/t(o);var s=Math.abs(r-o);o=r}while(s>Number.EPSILON);return r},I=e.Utils.isSymbol(b)?b:d(b),C=e.Utils.variables(I),k=C.length;if(I.group===p||I.group===v&&I.contains(H))return[new l(0)];var _,T={},F=function(t){var r=t.clone();if(t.symbols)for(var o in t.symbols){var a=t.symbols[o],s=i(a,H),c=s[1].fname===e.Settings.SQRT,p=l.unwrapSQRT(s[1]),v=p.power.clone();if(!u(v)&&!v.equals(.5))if(v.den.gt(1)){if(c)return t=n.subtract(t,a.clone()),t=n.add(t,n.multiply(s[0].clone(),p)),F(t);var g=T[v.den];T[v.den]=g?g++:1}else{if(-1===v.sign()){var m=n.parse(H+"^"+Math.abs(v));return t.each(function(e,r){e.contains(H)&&(t.symbols[r]=n.multiply(e,m.clone()))}),T={},F(n.parse(t))}if(a.group===f){var h=e.Utils.arrayMin(e.Utils.keys(a.symbols));if(h<0){m=n.parse(H+"^"+Math.abs(h));var S=new l(0);return r.each(function(e){S=n.add(S,n.multiply(e.clone(),m.clone()))},!0),S}}}}return t},O=function(t,r){r=r||new l(0);var i=0,o=(t=l.unwrapSQRT(n.expand(t))).length;if(t.group===g&&t.contains(H)&&t.isLinear()){t.distributeMultiplier();var a=new l(0);return t.each(function(e){e.contains(H)?(i++,a=n.add(a,e.clone())):r=n.subtract(r,e.clone())}),t=a,i!==o?O(t,r):[t,r]}if(t.group===v&&t.contains(H)&&t.isLinear()){if(t.multiplier.lessThan(0)&&(t.multiplier=t.multiplier.multiply(new e.Frac(-1)),r.multiplier=r.multiplier.multiply(new e.Frac(-1))),r.equals(0))return new l(0);a=new l(1);return t.each(function(e){e.contains(H)?a=n.multiply(a,e.clone()):r=n.divide(r,e.clone())}),O(t=a,r)}if(!t.isLinear()&&t.contains(H)){var s=n.parse(t.power.clone().invert());return t=n.pow(t,s.clone()),r=n.pow(n.expand(r),s.clone()),O(t,r)}if(t.group===m||t.group===p||t.group===f)return[t,r]},P=function(e){var t=new l(0),r=new l(0);return e.each(function(e){e.contains(H,!0)?t=n.add(t,e.clone()):r=n.subtract(r,e.clone())}),[t,r]};if((I=F(I)).equals(0))return[I];var G=e.Utils.keys(T);if(1===G.length&&(_=G[0],I.each(function(t,r){if(t.contains(H)){var o=i(t,H),a=o[1],s=a.power;s.den.gt(1)&&(a.power=s.multiply(new e.Frac(_)),I.symbols[r]=n.multiply(a,o[0]))}}),I=n.parse(I)),1===k)if(I.isPoly(!0)){var V=(Q=e.Utils.getCoeffs(I,H)).length-1,D=!1;if(C[0]===H){if(y(Q,function(n){return n.group!==e.groups.N})){var Y=e.Algebra.proots(I);y(Y,function(n){return!e.Utils.isInt(n)})&&(D=!0,Y.map(function(e){N(new l(e))}))}if(!D)if(1===V)N(n.divide(Q[0],Q[1].negate()));else if(2===V)N(n.expand(w.apply(void 0,Q))),Q.push("-"),N(n.expand(w.apply(void 0,Q)));else if(3===V)N(x.apply(void 0,Q));else{var j=U(I,H);0===j.length&&(j=R(I,H)),j.length>0?N(j):t.proots(I).map(N)}}}else!function(n){for(var t=n.hasTrig(),i=function(n){var t=s(n),r=Math.round(t(0)),i=t(r),o=i/Math.abs(i),a=[],l=e.Settings.ROOTS_PER_SIDE,u=2*l+1;a.push(Math.floor(r/2)),n.each(function(e){e.containsFunction("ln")&&a.push(.1)});for(var c=r;c<e.Settings.SOLVE_RADIUS;c++){var p=(f=t(.1*c))/Math.abs(f);if(isNaN(f)||!isFinite(f)||a.length>l)break;p!==o&&a.push((c-1)/2),o=p}for(c=r-1;c>-e.Settings.SOLVE_RADIUS;c--){var f;if(p=(f=t(c))/Math.abs(f),isNaN(f)||!isFinite(f)||a.length>u)break;p!==o&&a.push((c-1)/2),o=p}return a}(n),o=i.length,a=s(n.clone()),l=s(r.diff(n.clone())),u=0;u<o;u++){var c=i[u];N(M(c,a,l),t)}L.sort()}(I);else if(!I.hasFunc(H)&&I.isComposite())try{var Q;switch(V=(Q=e.Utils.getCoeffs(I,H)).length-1){case 0:var B=(z=P(I))[0],X=z[1];B.group===e.groups.EX&&N(n.parse(e.Utils.format("log(({0})/({2}))/log({1})",X,B.value,B.multiplier)));break;case 1:N(n.divide(Q[0],Q[1].negate()));break;case 2:N(w.apply(void 0,Q)),Q.push("-"),N(w.apply(void 0,Q));break;case 3:N(x.apply(void 0,Q));break;case 4:N(function(t,r,i,o,s){var l,u,f,v,g,m={};return e.Utils.arrayUnique(c(s).concat(c(o)).concat(c(i)).concat(c(r)).concat(c(t))).map(function(e){m[e]=1}),s=s.toString(),o=o.toString(),i=i.toString(),r=r.toString(),t=t.toString(),l=n.parse(a("(8*({0})*({2})-3*({1})^2)/(8*({0})^2)",s,o,i)).toString(),u=n.parse(a("(({1})^3-4*({0})*({1})*({2})+8*({0})^2*({3}))/(8*({0})^3)",s,o,i,r)).toString(),f=n.parse(a("12*({0})*({4})-3*({1})*({3})+({2})^2",s,o,i,r,t)).toString(),v=n.parse(a("2*({2})^3-9*({1})*({2})*({3})+27*({1})^2*({4})+27*({0})*({3})^2-72*({0})*({2})*({4})",s,o,i,r,t)).toString(),g=n.parse(a("((({1})+(({1})^2-4*({0})^3)^(1/2))/2)^(1/3)",f,v)).toString(),p=n.parse(a("(1/2)*(-(2/3)*({1})+(1/(3*({0}))*(({2})+(({3})/({2})))))^(1/2)",s,l,g,f)).toString(),[n.parse(a("-(({1})/(4*({0})))-({4})+(1/2)*sqrt(-4*({4})^2-2*({2})+(({3})/({4})))",s,o,l,u,p)),n.parse(a("-(({1})/(4*({0})))-({4})-(1/2)*sqrt(-4*({4})^2-2*({2})+(({3})/({4})))",s,o,l,u,p)),n.parse(a("-(({1})/(4*({0})))+({4})+(1/2)*sqrt(-4*({4})^2-2*({2})-(({3})/({4})))",s,o,l,u,p)),n.parse(a("-(({1})/(4*({0})))+({4})-(1/2)*sqrt(-4*({4})^2-2*({2})-(({3})/({4})))",s,o,l,u,p))]}.apply(void 0,Q));break;default:N(U(I,H)),0===L.length&&N(R(I,H))}}catch(e){}else try{var Z=O(I);B=Z[0],X=Z[1];B.group===m&&("abs"===B.fname?(L.push(X.clone()),L.push(X.negate())):L.push(n.subtract(B,X)))}catch(t){try{if(I.group===v)L.push(0);else if(I.group===g){var z;B=(z=P(I))[0],X=z[1];if(B.group===e.groups.EX&&B.value===H){var J=B.power.clone().invert();L.push(n.pow(X,J))}}}catch(e){}}return _&&(L=L.map(function(e){return n.pow(e,new l(_))})),L};e.Expression.prototype.solveFor=function(n){return q(e.Utils.isSymbol(this.symbol)?this.symbol:this.symbol.toLHS(),n).map(function(n){return new e.Expression(n)})},e.Expression.prototype.expand=function(){if(this.symbol instanceof S){var t=this.symbol.clone();return t.RHS=n.expand(t.RHS),t.LHS=n.expand(t.LHS),new e.Expression(t)}return new e.Expression(n.expand(this.symbol))},e.Expression.prototype.variables=function(){return this.symbol instanceof S?e.Utils.arrayUnique(c(this.symbol.LHS).concat(c(this.symbol.RHS))):c(this.symbol)};var H=function(e,t){return n.equals(e,t)};e.Equation=S,nerdamer.register([{name:"solveEquations",parent:"nerdamer",numargs:-1,visible:!0,build:function(){return q}},{name:"solve",parent:"Solve",numargs:2,visible:!0,build:function(){return e.Solve.solve}},{name:"setEquation",parent:"Solve",visible:!0,build:function(){return H}}]),nerdamer.api()}()